
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Blockly_Chaos: 蝴蝶效应与混沌</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://www.google.cn/jsapi"></script>
    <script src="https://cdn.jsdelivr.net/npm/blockly@4.20201217.0/blockly_compressed.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/blockly@4.20201217.0/blocks_compressed.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/blockly@4.20201217.0/javascript_compressed.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/blockly@4.20201217.0/msg/zh-hans.js"></script>
    <script src="navbar.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <style>
        .up-style {
            border: 15px solid rgba(33, 84, 118, 0.52);
            margin-top: 56px;
            padding: 0;
            overflow: hidden;
        }

        .down-style {
            margin-left: 0;
            border-left: 0;
            border: 15px solid rgba(33, 84, 118, 0.52);
            border-top: none;
            overflow: hidden;
            
        }
    </style>
<body>
    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div id="navbarContainer"></div>
                <div class="row">
                    <div class="col-md-12 up-style">
                        <div id="blocklyDiv" style="height: 700px"></div>
                    </div>
                    <div class="col-md-12 down-style">
                        <h3 class="text-left" style=" font-size: 20px; margin-top:20px; margin-left:20px;">
                            结果可视化:
                        </h3>
                <div style="margin-left: 40%;margin-bottom: 3%;">
                        <button onclick="showCode()">Show JavaScript</button>
            <button onclick="runCode()">Run</button></div>
            <div id="visualization" style="margin-left: 1%;"></div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    </div>

<!-- The left side menu -->


<xml id="toolbox" style="display: none"></xml>
<script src="toolbox.js"></script>

<script src="block.js"></script>
<script src="visualization.js"></script>

<xml xmlns="https://developers.google.com/blockly/xml" id="startBlocks" style="display: none">

    <variables>
        <variable >x1</variable>
        <variable >x2</variable>
        <variable >xlist1</variable>
        <variable >xlist2</variable>
        <variable >R</variable>
    </variables>

    <block type ="variables_set" x = 100 y = 50 >
        <field name = "VAR">R</field>
        <value name="VALUE">
            <block type="math_number">
                <field name="NUM">3.9</field>
            </block>
        </value>
        <next>
            <block type ="variables_set">
                <field name = "VAR">x1</field>
                <value name="VALUE">
                    <block type="math_number">
                        <field name="NUM">0.2</field>
                    </block>
                </value>
                <next>
                    <block type ="variables_set" x = 100 y = 100 >
                        <field name = "VAR">x2</field>
                        <value name="VALUE">
                            <block type="math_number">
                                <field name="NUM">0.201</field>
                            </block>
                        </value>
                        <next>
                            <block type = "variables_set">
                                <field name = "VAR">xlist1</field>
                                <value name = "VALUE">
                                    <block type = "lists_create_empty">
                                    </block>
                                </value>
                                <next>
                                    <block type = "variables_set">
                                        <field name = "VAR">xlist2</field>
                                        <value name = "VALUE">
                                            <block type = "lists_create_empty">
                                            </block>
                                        </value>
                                        <next>
                                            <block type = "controls_repeat_ext" >
                                                <value name = "TIMES">
                                                    <block type="math_number">
                                                        <field name="NUM">200</field>
                                                    </block>
                                                </value>
                                                <statement name = "DO">
                                                    <block type = "lists_setIndex">
                                                        <mutation at="true"></mutation>
                                                        <field name="MODE">INSERT</field>
                                                        <field name="WHERE">LAST</field>
                                                        <value name="LIST">
                                                            <block type="variables_get">
                                                                <field name="VAR">xlist1</field>
                                                            </block>
                                                        </value>
                                                        <value name="TO">
                                                            <block type = "math_arithmetic">
                                                                <field name="OP">MULTIPLY</field>
                                                                <value name="A">
                                                                    <block type = "math_arithmetic">
                                                                        <field name="OP">MINUS</field>
                                                                        <value name="A">
                                                                            <block type="math_number">
                                                                                <field name="NUM">1</field>
                                                                            </block>
                                                                        </value>
                                                                        <value name="B">
                                                                            <block type="variables_get">
                                                                                <field name="VAR">x1</field>
                                                                            </block>
                                                                        </value>
                                                                    </block>
                                                                </value>
                                                                <value name="B">
                                                                    <block type = "math_arithmetic">
                                                                        <field name="OP">MULTIPLY</field>
                                                                        <value name="A">
                                                                            <block type="variables_get">
                                                                                <field name = "VAR">R</field>
                                                                            </block>
                                                                        </value>
                                                                        <value name="B">
                                                                            <block type="variables_get">
                                                                                <field name="VAR">x1</field>
                                                                            </block>
                                                                        </value>
                                                                    </block>
                                                                </value>
                                                            </block>
                                                        </value>

                                                        <next>
                                                            <block type ="variables_set">
                                                                <field name = "VAR">x1</field>
                                                                <value name="VALUE">
                                                                    <block type = "math_arithmetic">
                                                                        <field name="OP">MULTIPLY</field>
                                                                        <value name="A">
                                                                            <block type = "math_arithmetic">
                                                                                <field name="OP">MINUS</field>
                                                                                <value name="A">
                                                                                    <block type="math_number">
                                                                                        <field name="NUM">1</field>
                                                                                    </block>
                                                                                </value>
                                                                                <value name="B">
                                                                                    <block type="variables_get">
                                                                                        <field name="VAR">x1</field>
                                                                                    </block>
                                                                                </value>
                                                                            </block>
                                                                        </value>
                                                                        <value name="B">
                                                                            <block type = "math_arithmetic">
                                                                                <field name="OP">MULTIPLY</field>
                                                                                <value name="A">
                                                                                    <block type="variables_get">
                                                                                        <field name = "VAR">R</field>
                                                                                    </block>
                                                                                </value>
                                                                                <value name="B">
                                                                                    <block type="variables_get">
                                                                                        <field name="VAR">x1</field>
                                                                                    </block>
                                                                                </value>
                                                                            </block>
                                                                        </value>
                                                                    </block>
                                                                </value>
                                                                <next>
                                                                    <block type = "lists_setIndex">
                                                                        <mutation at="true"></mutation>
                                                                        <field name="MODE">INSERT</field>
                                                                        <field name="WHERE">LAST</field>
                                                                        <value name="LIST">
                                                                            <block type="variables_get">
                                                                                <field name="VAR">xlist2</field>
                                                                            </block>
                                                                        </value>
                                                                        <value name="TO">
                                                                            <block type = "math_arithmetic">
                                                                                <field name="OP">MULTIPLY</field>
                                                                                <value name="A">
                                                                                    <block type = "math_arithmetic">
                                                                                        <field name="OP">MINUS</field>
                                                                                        <value name="A">
                                                                                            <block type="math_number">
                                                                                                <field name="NUM">1</field>
                                                                                            </block>
                                                                                        </value>
                                                                                        <value name="B">
                                                                                            <block type="variables_get">
                                                                                                <field name="VAR">x2</field>
                                                                                            </block>
                                                                                        </value>
                                                                                    </block>
                                                                                </value>
                                                                                <value name="B">
                                                                                    <block type = "math_arithmetic">
                                                                                        <field name="OP">MULTIPLY</field>
                                                                                        <value name="A">
                                                                                            <block type="variables_get">
                                                                                                <field name = "VAR">R</field>
                                                                                            </block>
                                                                                        </value>
                                                                                        <value name="B">
                                                                                            <block type="variables_get">
                                                                                                <field name="VAR">x2</field>
                                                                                            </block>
                                                                                        </value>
                                                                                    </block>
                                                                                </value>
                                                                            </block>
                                                                        </value>

                                                                        <next>
                                                                            <block type ="variables_set">
                                                                                <field name = "VAR">x2</field>
                                                                                <value name="VALUE">
                                                                                    <block type = "math_arithmetic">
                                                                                        <field name="OP">MULTIPLY</field>
                                                                                        <value name="A">
                                                                                            <block type = "math_arithmetic">
                                                                                                <field name="OP">MINUS</field>
                                                                                                <value name="A">
                                                                                                    <block type="math_number">
                                                                                                        <field name="NUM">1</field>
                                                                                                    </block>
                                                                                                </value>
                                                                                                <value name="B">
                                                                                                    <block type="variables_get">
                                                                                                        <field name="VAR">x2</field>
                                                                                                    </block>
                                                                                                </value>
                                                                                            </block>
                                                                                        </value>
                                                                                        <value name="B">
                                                                                            <block type = "math_arithmetic">
                                                                                                <field name="OP">MULTIPLY</field>
                                                                                                <value name="A">
                                                                                                    <block type="variables_get">
                                                                                                        <field name = "VAR">R</field>
                                                                                                    </block>
                                                                                                </value>
                                                                                                <value name="B">
                                                                                                    <block type="variables_get">
                                                                                                        <field name="VAR">x2</field>
                                                                                                    </block>
                                                                                                </value>
                                                                                            </block>
                                                                                        </value>
                                                                                    </block>
                                                                                </value>

                                                                            </block>
                                                                        </next>


                                                                    </block>

                                                                </next>

                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                                <next>
                                                    <block type = "draw_line">
                                                        <value name = "line">
                                                            <block type="variables_get">
                                                                <field name="VAR">xlist1</field>
                                                            </block>
                                                        </value>
                                                        <field name = "Color">#FF3030</field>
                                                        <field name = "NAME">    x1</field>
                                                        <next>
                                                            <block type = "draw_line">
                                                                <value name = "line">
                                                                    <block type="variables_get">
                                                                        <field name="VAR">xlist2</field>
                                                                    </block>
                                                                </value>
                                                                <field name = "Color">#008B00</field>
                                                                <field name = "NAME">    x2</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </next>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>

                        </next>
                    </block>
                </next>
            </block>
        </next>
    </block>

</xml>

<script>
 

    // Define the custom blocks and their JS generators.


const workspace = Blockly.inject('blocklyDiv', {
    toolbox: document.getElementById('toolbox'),
});

Blockly.Xml.domToWorkspace(document.getElementById("startBlocks"), workspace);
workspace.clearUndo();

function showCode() {
    // Generate JavaScript code and display it.
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    var code = Blockly.JavaScript.workspaceToCode(workspace);
    alert(code);
    console.log(code);
};


   // Load the Google Chart Tools Visualization API and the chart package.
   if (typeof google == 'object') {
        google.charts.load('current', {'packages':['line']});
    } else {
        alert('Unable to load Google\'s chart API.\n' +
            'Are you connected to the Internet?');
    };

function runCode() {
    const code = Blockly.JavaScript.workspaceToCode(workspace);
    lines = [];
    keys = [];
    colors = [];
   
    eval(code);

    
};



</script>

</body>

</html>
